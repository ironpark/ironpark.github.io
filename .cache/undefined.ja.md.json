{"metadataHash":"0f4277397b9f56bfb0c5e949840446d43bc6efe902f844bb22d7f023fbbbdcb4","contentHash":"b05ad1b7b308b092088843313a264c9cbd521986eee722c34178222e6a1bcbbf","metadata":{"created":"2025-08-13T02:35","updated":"2025-08-30T04:04:22.000Z","published":null,"title":"Papers, Please","subTitle":"通過できない。","description":"クッキーとセッション、そしてトークン認証システムについて","series":"papers-please-the-authentication","categories":["Thoughts"],"tags":null,"lang":"ja","thumbnail":"","originalLang":"ko"},"content":"![[paper-please.svg]]\n### アルストツカへようこそ\n\n2013年、あるインディーゲームが世界中のゲーマーを架空の国境検問所へ招待しました。Papers, Please - プレイヤーは架空の国家アルストツカの国境検問官となり、一日中パスポートを検査し、書類を照合し、入国許可のスタンプを押します。\n\n一見退屈に見えるこのゲームがなぜこれほど人気を博したのでしょうか？それは独特なゲームコンセプト、没入感の高い雰囲気、そして何よりプレイヤーに絶え間ない**倫理的ジレンマ**を突きつけるシステムがあるからです。規則を守れば家族が飢え、情をかければテロリストが入国するかもしれない。毎日変わる入国規則、ますます巧妙になる偽造書類、そして「どうか今回だけ見逃してください」という懇願の間で、プレイヤーは絶えず判断し、その結果を背負わなければなりません。\n\n### バックエンド開発者、デジタル世界の国境検問官\n![[ss_c133e1bf1da17a3f3719c74696c61da23e38eefe.1920x1080.jpg]]\n> なんて厳しい国境だ、真面目に働いてていいねえ **入国のなんとかを持ってまた来るんだな** - Jorji Costava  \n> *ゲーム Paper, Please より*\n\nちょっと待って、この状況は見覚えがある。\n\n`POST /api/login`\n```json\n{\n  \"username\": \"jorji_costava\",\n  \"password\": \"cobrastan_best\"\n}\n```\n\nバックエンド開発者の日常も大きくは変わりません。毎瞬、小さければ数十、多ければ数千、数万のHTTPリクエストが私たちのAPIゲートウェイの前に列を作ります。それぞれのリクエストは自分が正当なユーザーだと主張し、私たちのサービスへのアクセスを求めます。\n\n- このリクエストは本物のユーザーからのものか、それともボットか？\n- このトークンは有効か？期限切れではないか？\n- このユーザーはこのリソースにアクセスする権限があるか？\n- 5秒前にも同じリクエストを送った気がする…ブルートフォース攻撃か？\n\nPapers, Pleaseの検問官がパスポートの有効期限を確認し、写真と本人を照合し、入国目的を審査するように、私たちは毎リクエストごとに認証(Authentication)と認可(Authorization)という名の書類審査を行っています。\n\n### ますます複雑になる入国規則\n\nゲーム内のアルストツカの入国規則は日を追うごとに複雑化します。最初は「パスポートだけ確認してください」だったルールが、いつの間にか「コレチア市民は入国許可証が必要、インプル出身者は追加の身元調査、すべての外国人は予防接種証明書の提出」と進化します。\n\n現実のウェブサービスも同様です。最初は単純なID/パスワード確認から始まりましたが、今では二段階認証(2FA)、OAuthソーシャルログイン、生体認証、デバイスフィンガープリント、位置情報に基づくアクセス制御、レートリミット… **新しい標準や攻撃手法、そしてドメインに応じて増え続ける検問手続きは終わりがありません。おそらく増える一方で減ることはないでしょう。** ~~なくしたらレガシーはどうするんだレガシーは~~\n\n### 重要な検問ツール三種\n\n今日はレートリミットや生体認証のような特殊な検問技術は扱いません。代わりに、すべてのバックエンド開発者が必ず習得すべき**最も基本的かつ重要な本人確認方法**三種—セッション、クッキー、そしてトークンについて深掘りします。これらはPapers, Pleaseのパスポート、入国許可証、通行証のようにデジタル世界の基本的な書類です。  \n新しい標準や攻撃手法、そしてドメインに応じて増え続ける検問手続きは終わりがなく、おそらく増える一方で減ることはないでしょう。\n\n### 私たちが直面する三つの検問方式\n\n ![[Pasted image 20250813152303.png]]\nそこで今日はバックエンド開発者がデジタル国境を守る三つの重要な方法をPapers, Pleaseのメタファーと共に見ていきます。\n\n**セッション(Session)** - 検問所がすべてを記憶する方法  \n**クッキー(Cookie)** - 訪問者に一時的な通行証を発行する方法  \n**トークン(JWT)** - 偽造不可能なスマートパスポートを使う方法\n\nそれぞれの方式には長所短所があり、状況に応じて適切に選択しなければなりません。まるでPapers, Pleaseで規則と情けの間でバランスを取るように。\n\nさあ、検問所のブースに座りましょう。  \n> _「次の方！」_  \n"}